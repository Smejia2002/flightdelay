# âœˆï¸ FlightOnTime - PredicciÃ³n de Retrasos de Vuelos

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![XGBoost](https://img.shields.io/badge/XGBoost-2.0+-green.svg)](https://xgboost.readthedocs.io/)
[![Plotly](https://img.shields.io/badge/Plotly-5.18+-purple.svg)](https://plotly.com/)
[![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)

**VersiÃ³n**: final.    
**Ãšltima actualizaciÃ³n**: 2026-01-24  

---

## ğŸ“‹ DescripciÃ³n

**FlightOnTime** es un sistema de predicciÃ³n de retrasos de vuelos que utiliza Machine Learning (XGBoost) para estimar si un vuelo despegarÃ¡ a tiempo o con retraso, entrenado con el **dataset completo (35,668,549 registros)** y equipado con visualizaciones estÃ¡ticas, aptas para visualizaciÃ³n rÃ¡pida y ligera. Para las visualizaciones interactivas dirigirse a repositorio del Dashboard. El dataset utilizado fue creado por el equipo. Se incluye un script para la descarga del mismo, sin embargo, el dataset completo no se encuentra versionado por tamaÃ±o. Puede acceder a Ã©l mediante su enlace en **HuggingFace.** Este modelo ayuda a reducir la **incertidumbre en la planificaciÃ³n de viajes** mediante un sistema de **alerta temprana** basado en datos histÃ³ricos de mÃ¡s de 35 millones de vuelos.

### ğŸ¯ Objetivo

ClasificaciÃ³n binaria que predice:
- **0 = Puntual**: El vuelo saldrÃ¡ a tiempo
- **1 = Retrasado**: El vuelo tendrÃ¡ un retraso â‰¥ 15 minutos

### ğŸ‘¥ Beneficiarios

- ğŸ›« **Pasajeros**: Alertas hasta 24h antes de salir de casa
- âœˆï¸ **AerolÃ­neas**: OptimizaciÃ³n operativa y comunicaciÃ³n proactiva
- ğŸ›ï¸ **Aeropuertos**: Mejor planificaciÃ³n de infraestructura

---

## ğŸ”„ Flujo del modelo

[API REST (Solicitud de PredicciÃ³n)]
      â†“
[Preprocesamiento / Feature Engineering]
      â†“
[Carga del Modelo (.joblib)]
      â†“
[Inferencia / PredicciÃ³n]
      â†“
[Respuesta API (clasificaciÃ³n + probabilidad)]

---

## ğŸ“Š Resultados del Modelo

### Modelo Seleccionado: **XGBoost**

**Entrenado con**: 35,668,549 registros (70% Train, 15% Val, 15% Test)  
**Ãšltima actualizaciÃ³n**: 2026-01-13  
**Threshold optimizado**: 0.5591 (balance precision/recall)

| Metrica       | Test Set (5.35M) | Validation Set (5.35M) | Cambio vs v1.0 |
| ------------- | ---------------- | ---------------------- | -------------- |
| **Accuracy**  | **72.32%**       | N/A                 | N/A            |
| **Precision** | **35.01%**       | N/A                 | N/A            |
| **Recall**    | **54.30%**       | N/A                 | N/A            |
| **F1-Score**  | **42.57%**       | N/A                 | N/A            |
| **ROC-AUC**   | **0.7194**       | N/A                 | N/A            |
| **PR-AUC**    | **0.3874**       | N/A                 | N/A            |

\* Con threshold optimizado 0.5591  

### Matriz de ConfusiÃ³n (Test Set: 5.35M registros)
```
                   PredicciÃ³n
                 Puntual  Retrasado
Real Puntual    3,319,108  1,018,723  (76.5% correctos)
     Retrasado    461,820   548,682  (54.3% detectados)
```

### Top 5 Features MÃ¡s Importantes
1. `sched_minute_of_day` - Minuto del dÃ­a (mÃ¡s predictivo)
2. `year` - AÃ±o del vuelo (patrones 2020-2024)
3. `climate_severity_idx` - Severidad climÃ¡tica
4. `op_unique_carrier_encoded` - AerolÃ­nea
5. `month` - Mes del aÃ±o

---

## ğŸ“ Estructura del Proyecto

```
flightdelay/
â”œâ”€â”€ ğŸ“‚ data/                            # INFORMACIÃ“N BASE DEL PROYECTO
â”‚   â”œâ”€â”€ airports_be.csv                 # CSV de aeropuertos con cÃ³digos IATA para conexiones Back-End  
â”‚   â”œâ”€â”€ data_dictionary.csv             # CSV diccionario sobre el dataset original  
â”‚   â”œâ”€â”€ data_dictionary.md              # MD descriptivo sobre el dataset y las variables usadas en el entrenamiento
â”‚   â””â”€â”€ download_data.py                # Script Python para descarga del dataset desde HuggingFace si se desea.
â”‚
â”œâ”€â”€ ğŸ“‚ user_manual/                      # MANUAL DE USUARIO
â”‚   â””â”€â”€ manual_tecnico_FlightOnTime.pdf  # Manual mÃ¡s detallado para el usuario
â”‚
â”œâ”€â”€ ğŸ“‚ notebooks/                     # NOTEBOOKS
â”‚   â”œâ”€â”€ exploratory/                  # AnÃ¡lisis exploratorio
â”‚   â”‚   â”œâ”€â”€ 00_eda.ipynb              # EDA del primer dataset elegido desde Kaggle
â”‚   â”‚   â””â”€â”€ 01_eda2.ipynb             # Primer EDA del dataset creado por el equipo
â”‚   â”œâ”€â”€ data_engineering/             # Procesamiento del dataset creado por el equipo
â”‚   â”‚   â””â”€â”€ 01_Data_Ingestion_and_Merging.ipynb   # Procesamiento, ennriquecimiento climÃ¡tico y geogrÃ¡fico
â”‚   â””â”€â”€ EDA_final.ipynb               # EDA final realizado por el equipo
â”‚
â”œâ”€â”€ ğŸ“‚ src/                            # CÃ“DIGO MODULAR
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                      # ConfiguraciÃ³n central
â”‚   â”œâ”€â”€ features.py                    # Feature engineering (17 features)
â”‚   â”œâ”€â”€ modeling.py                    # Modelos ML (4 algoritmos)
â”‚   â””â”€â”€ evaluation.py                  # EvaluaciÃ³n (matplotlib)
â”‚
â”œâ”€â”€ ğŸ“‚ models/                         # MODELOS ENTRENADOS
â”‚   â”œâ”€â”€ model.joblib                   # XGBoost (502KB)
â”‚   â”œâ”€â”€ metadata.json                  # Metadatos (threshold: 0.5591)
â”‚   â”œâ”€â”€ feature_engineer.joblib        # Transformador (35KB)
â”‚   â”œâ”€â”€ optimize_threshold.py          # Optimizador de umbral
â”‚   â””â”€â”€ training_info.json             # Info entrenamiento 35,668,549
â”‚
â”œâ”€â”€ ğŸ“‚ outputs/                         # VISUALIZACIONES
â”‚   â”œâ”€â”€ figures/                        # GrÃ¡ficos 
â”‚   â”‚   â””â”€â”€ *.png                       # GrÃ¡ficos estÃ¡ticos
â”‚   â””â”€â”€ metrics/                        # MÃ©tricas
â”‚       â”œâ”€â”€ evaluation_report.md        # Reporte de evaluaciÃ³n
â”‚       â”œâ”€â”€ evaluation_results.json     # Resultados de 4 modelos
â”‚       â””â”€â”€ threshold_optimization.json # AnÃ¡lisis de thresholds
â”‚
â”œâ”€â”€ ğŸ“‚ optional_helpers/
â”‚   â”œâ”€â”€ predict.py                         # PredicciÃ³n en tiempo real
â”‚   â”œâ”€â”€ generate_interactive_viz.py        # Script de regeneraciÃ³n de todas las visualizaciones
â”‚   â”œâ”€â”€ interactive_viz.py                 # Generador visualizaciones
â”‚   â””â”€â”€ interact_with_model.py             # InteracciÃ³n con el modelo
â”‚
â”œâ”€â”€ .gitignore  
â”œâ”€â”€ train_model.py                     # Pipeline principal (dataset completo)
â”œâ”€â”€ README.md                          # Este archivo
â””â”€â”€ requirements.txt                   # Dependencias
```
---

## ğŸ¨ Visualizaciones

Repositorio incluye visualizaciones estÃ¡ticas.  
Para las visualizaciones interactivas, dirigirse a repositorio del Dashboard.

### ğŸ“Š **Visualizaciones Disponibles**

| VisualizaciÃ³n                 | Tipo      | CaracterÃ­sticas                   |
| ----------------------------- | --------- | --------------------------------- |
| ğŸ“Š **Matriz de ConfusiÃ³n**    | Heatmap   | Interactivo con mÃ©tricas en hover |
| ğŸ“ˆ **Curva ROC**              | LÃ­nea     | Punto Ã³ptimo, AUC=0.717           |
| ğŸ“‰ **Precision-Recall**       | LÃ­nea     | Mejor F1 marcado, AP=0.38         |
| â­ **Feature Importance**     | Barras    | Top 17 con gradientes             |
| ğŸšï¸ **Threshold Analysis**     | Dual      | Trade-offs precision-recall       |
| ğŸ† **Threshold Optimization** | Combinado | Comparacion mÃ©tricas vs umbrales  |
| ğŸ† **ComparaciÃ³n Modelos**    | Barras    | 4 modelos comparados              |

**CaracterÃ­sticas**:
- ExportaciÃ³n a PNG de alta calidad
- Adecuado para presentaciones y demos
- Posibilidad de exportar visualizaciones interactivas HTML si se desea.

---

## ğŸš€ InstalaciÃ³n

### 1. Requisitos previos
- Python 3.10 o superior
- 8GB RAM mÃ­nimo 

El repositorio provee un modelo ya entrenado y serializado en formato `.joblib`. Los modelos `.joblib` son livianos una vez cargados en la memoria y la API tiene bajo consumo.
En caso de desear reproducir el entrenamiento del modelo, los requisitos se elevan debido a la mayor demanda computacional del mismo. Se recomienda:
- 16GB RAM mÃ­nimo (recomendado para entrenamiento)

### 2. Clonar/Descargar el proyecto
```bash
# Clonar el repositorio
git clone https://github.com/Smejia2002/flightdelay
cd flightdelay
```

### 3. Crear entorno virtual (recomendado)
```bash
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac
```

### 4. Instalar dependencias
```bash
pip install -r requirements.txt
```

---

## ğŸ”§ Uso

### 1ï¸âƒ£ **Entrenar el modelo** (opcional - ya pre-entrenado)
```bash
python train_model.py
```
â±ï¸ Tiempo estimado: ~27 minutos con dataset completo (depende de hardware)

### 2ï¸âƒ£ **Hacer predicciones en tiempo real** â­
```bash
python optional_helpers/predict.py
```

**Modos disponibles:**
- **1. Ejemplo simple**: Demo con vuelo AA JFKâ†’LAX
- **2. Batch**: MÃºltiples vuelos simultÃ¡neos
- **3. Interactivo**: Ingresa datos manualmente

**Ejemplo de salida:**
```
PrevisiÃ³n: Retrasado
Probabilidad de retraso: 72.73%
Confianza: Media
Umbral usado: 0.5591
```

### 3ï¸âƒ£ **Optimizar el umbral de decisiÃ³n** â­
```bash
python optimize_threshold.py
```

**Analiza diferentes umbrales para:**
- Maximizar **Recall** (detectar mÃ¡s retrasos)
- Maximizar **Precision** (menos falsas alarmas)
- Mejor **F1-Score** (balance Ã³ptimo)

**Opciones de velocidad:**
- OpciÃ³n 1: 100K registros (~1 min) âš¡ Recomendado
- OpciÃ³n 2: 500K registros (~3 min)
- OpciÃ³n 3: 5.35M registros (~8 min)

### 4ï¸âƒ£ **Generar visualizaciones interactivas** â­
```bash
python generate_interactive_viz.py
```

Genera 6 visualizaciones HTML interactivas con Plotly.

### 5ï¸âƒ£ **Uso programÃ¡tico del modelo**
```python
import joblib
import json

# Cargar modelo y metadatos
model = joblib.load('models/model.joblib')
fe = joblib.load('models/feature_engineer.joblib')
with open('models/metadata.json', 'r') as f:
    metadata = json.load(f)

# Predecir (ver predict.py para ejemplo completo)
```

---

## ğŸ”Œ **API REST (Backend)**

Para la API REST, dirigirse al repositorio de Back-End del proyecto.

### **Ejemplo: POST /predict**

**Request**:
```json
{
  "aerolinea": "AA",
  "origen": "JFK",
  "destino": "LAX",
  "fecha_partida": "2025-11-10T14:30:00",
  "distancia_km": 3983
}
```

**Response**:
```json
{
  "prevision": "Retrasado",
  "probabilidad": 0.78,
  "confianza": "Alta",
  "detalles": {
    "umbral_usado": 0.5591,
    "probabilidad_puntual": 0.22,
    "probabilidad_retrasado": 0.78
  }
}
```

### **Ejemplos con cURL**

```bash
# Caso puntual
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "aerolinea": "DL",
    "origen": "ATL",
    "destino": "ORD",
    "fecha_partida": "2025-06-15T08:00:00",
    "distancia_km": 975
  }'

# Caso retrasado
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "aerolinea": "UA",
    "origen": "SFO",
    "destino": "JFK",
    "fecha_partida": "2025-12-20T18:00:00",
    "distancia_km": 4150,
    "temperatura": 8.0,
    "velocidad_viento": 32.0,
    "precipitacion": 8.5
  }'
```

---

## ğŸ”§ CaracterÃ­sticas del Modelo (17 Total)

A continuaciÃ³n, se presentan las caracterÃ­sticas o _features_ escogidas para el modelo. Estas _features_ fueron escogidas cuidadosamente, eligiendo solo aquellas relevantes para la predicciÃ³n y disponibles de forma previa al vuelo. De esta forma, se evita la fuga de informaciÃ³n o _data leakage,_ lo que habrÃ­a comprometido la confiabilidad del modelo. 

### ğŸ• Temporales (6)
- `year`, `month`, `day_of_week`, `day_of_month`, `dep_hour`, `sched_minute_of_day`

### âœˆï¸ OperaciÃ³n (3 - codificadas)
- `op_unique_carrier`, `origin`, `dest`

### ğŸ“ Distancia (1)
- `distance`

### ğŸŒ¦ï¸ Clima (5)
- `temp`, `wind_spd`, `precip_1h`, `climate_severity_idx`, `dist_met_km`

### ğŸ—ºï¸ GeogrÃ¡ficas (2)
- `latitude`, `longitude`

### âš ï¸ Excluidas (Evitar Leakage)
- `DEP_DEL15` (target), `DEP_DELAY`, `STATION_KEY`, `FL_DATE`

---

## ğŸ› ï¸ TecnologÃ­as

Las tecnologÃ­as utilizadas fueron seleccionadas considerando eficiencia en el procesamiento de datos, desempeÃ±o del modelo y facilidad de integraciÃ³n con sistemas Back-End. AdemÃ¡s de las herramientas listadas aquÃ­, durante la fase de procesamiento y entrenamiento se utilizaron herramientas como DuckDB para procesamiento eficiente de grandes volÃºmenes e imbalanced-learn para el manejo del desbalance de clases, sin embargo, estas no son un requerimiento actual para la utilizaciÃ³n del modelo.

### ğŸ Lenguaje base
- **Python 3.10+**

### ğŸ§ª Data Processing

- **Pandas 2.0+** â€“ Limpieza y manipulaciÃ³n de datos
- **NumPy 1.24+** â€“ CÃ¡lculos numÃ©ricos
- **DuckDB 0.9+** â€“ Procesamiento eficiente de grandes volÃºmenes
- **PyArrow 14.0+** â€“ Lectura y escritura de archivos Parquet

### ğŸ¤– Model Core

- **scikit-learn 1.5+** â€“ Pipeline de ML y mÃ©tricas
- **XGBoost 2.0+** â€“ Modelo principal de clasificaciÃ³n
- **LightGBM 4.0+** â€“ Modelo alternativo explorado
- **imbalanced-learn** â€“ Manejo del desbalance de clases

### ğŸ“Š VisualizaciÃ³n y AnÃ¡lisis
- **Plotly 5.15+** â€“ Visualizaciones interactivas
- **matplotlib 3.7+** â€“ GrÃ¡ficos estÃ¡ticos
- **seaborn 0.12+** â€“ VisualizaciÃ³n estadÃ­stica

### ğŸš€ Deployment & API
- **Joblib 1.3+** â€“ SerializaciÃ³n y carga de artefactos del modelo

---

## ğŸ“Š Dataset

| MÃ©trica                 | Valor                          |
| ----------------------- | ------------------------------ |
| Total de registros      | 35,668,549 vuelos              |
| Registros entrenamiento | 24,967,983 (70%)               |
| DivisiÃ³n                | 70% Train / 15% Val / 15% Test |
| PerÃ­odo temporal        | 2020-2024                      |
| Features del modelo     | 17                             |
| Tasa de retrasos        | 18.9%                          |
| Ratio desbalance        | 4.3:1                          |

---

## ğŸ“ Entregables del Hackathon

| Entregable                       | Estado | Archivo                               |
| -------------------------------- | ------ | ------------------------------------- |
| Notebook EDA                     |    âœ“   | `notebooks/EDA_final.ipynb`           |
| Feature Engineering              |    âœ“   | `src/features.py`                     |
| Modelo Entrenado                 |    âœ“   | `models/model.joblib` (dataset completo) |
| EvaluaciÃ³n                       |    âœ“   | `outputs/metrics/`                    |
| Visualizaciones EstÃ¡ticas        |    âœ“   | `outputs/figures/*.png`               |
| Script PredicciÃ³n                |    âœ“   | `optional_helpers/predict.py`         |
| Optimizador Threshold            |    âœ“   | `models/optimize_threshold.py`        |
| DocumentaciÃ³n                    |    âœ“   | `README.md` + `manual_tecnico_FlightOnTime`    |

---

## ğŸ‘¥ Equipo

**MODELS THAT MATTER**  
**Grupo 59** - Hackathon ONE 2026  
**Proyecto 3**: FlightOnTime âœˆï¸ â€” PredicciÃ³n de Retrasos de Vuelos

### Equipo de Desarrollo
- ğŸ§  **Data Science Team** - Machine Learning & Feature Engineering
- ğŸ’» **Backend Team** - API REST & Microservicios
- ğŸ¨ **Visualization Team** - Dashboards & UX

---

## ğŸ”— Enlaces Ãštiles

- ğŸ§­ [Dataset creado, disponible en HuggingFace](huggingface.co/datasets/mejiadev7/flight_delay)
- ğŸ’» [Repositorio Back-End](https://github.com/Zilini/flights-predictor)  
- ğŸ¯ [Repositorio Front-End](https://github.com/gezcarlos22/flights-frontend)  
- ğŸ“ˆ [Repositorio Dashboard](https://github.com/sumerce-sito/RETRASOS_VUELOS_4.0)
- ğŸ“Š [Dashboard Interactivo](https://bit.ly/FlightOnTime_2026)  

---

## ğŸ› Estado final del Proyecto

- Modelo entrenado con dataset completo (35,668,549 registros)
- Visualizaciones estÃ¡ticas e interactivas
- Scripts funcionales
- DocumentaciÃ³n completa
- Threshold optimizado
- Dashboard

---

*Ãšltima actualizaciÃ³n: 2026-01-24*  
*VersiÃ³n final - Hackathon ONE 2026*
*Desarrollado con â¤ï¸ usando Python, Streamlit (en Dashboard), XGBoost y dataset completo (35.7M)*
